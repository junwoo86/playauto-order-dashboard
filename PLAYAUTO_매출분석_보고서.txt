# PLAYAUTO API 활용한 매출 및 판매량 추이 분석 보고서

> 작성일: 2026-01-12
> 작성자: 개발팀
> 버전: 1.0

---

## 1. 프로젝트 개요

### 1.1 목적
플레이오토(PlayAuto) Open API를 활용하여 바이오컴 그룹의 다중 스토어 주문 데이터를 통합 수집하고, 스토어별/상품별 매출 분석 및 판매 추이 예측이 가능한 웹 대시보드 구축

### 1.2 개발 기간
2026년 1월

### 1.3 현재 상태
- **백엔드 서버**: ✅ 운영 중 (localhost:3001)
- **프론트엔드**: ✅ 운영 중 (localhost:5174)
- **데이터 동기화**: ✅ 정상 작동
- **자동 스케줄러**: ✅ 구현 완료

---

## 2. 기술 스택

### 2.1 백엔드 (server/)
| 기술 | 용도 |
|------|------|
| Node.js | 런타임 환경 |
| Express | 웹 프레임워크 |
| SQLite (better-sqlite3) | 로컬 데이터베이스 |
| node-cron | 자동 스케줄링 |
| xlsx | 엑셀 리포트 생성 |
| axios | PlayAuto API 통신 |

### 2.2 프론트엔드 (client/)
| 기술 | 용도 |
|------|------|
| React 18 | UI 프레임워크 |
| Vite | 빌드 도구 |
| Tailwind CSS | 스타일링 |
| Recharts | 차트 시각화 |
| React Query | 서버 상태 관리 |
| date-fns | 날짜 처리 |

---

## 3. 연동 스토어 현황

### 3.1 연동된 쇼핑몰 (12개)

| 쇼핑몰 코드 | 플랫폼 | 브랜드/별칭 |
|------------|--------|------------|
| B005 | 아임웹 | 바이오컴 자사몰 |
| 1005 | 아임웹-B | 바이오컴펫 자사몰 |
| 2005 | 아임웹-C | 더클린커피 자사몰 |
| 3005 | 아임웹-D | 에이아이바이오 자사몰 |
| 4005 | 아임웹-E | 미리바이오 자사몰 |
| A077 | 스마트스토어 | 더클린스토어 스마트스토어 |
| 1077 | 스마트스토어-B | 미리바이오 스마트스토어 |
| B378 | 쿠팡 | 쿠팡 (2개 계정) |
| A100 | 롯데아이몰 | - |

### 3.2 브랜드별 분류
- **바이오컴**: 바이오컴 자사몰
- **바이오컴펫**: 바이오컴펫 자사몰
- **더클린커피**: 더클린커피 자사몰, 더클린스토어 스마트스토어
- **에이아이바이오**: 에이아이바이오 자사몰
- **미리바이오**: 미리바이오 자사몰, 미리바이오 스마트스토어
- **쿠팡**: 쿠팡 (통합)

---

## 4. 데이터 수집 현황

### 4.1 수집 데이터 요약

| 항목 | 값 |
|------|-----|
| **총 주문 건수** | 28,248건 |
| **데이터 기간** | 2025-08-01 ~ 2026-01-12 (약 5개월) |
| **연동 스토어 수** | 12개 |
| **마지막 동기화** | 2026-01-12 03:21:03 |

### 4.2 데이터 수집 방식

#### PlayAuto API 제한사항
- **기간 제한**: 한 번 요청에 최대 7일까지만 조회 가능
- **과거 데이터**: 약 5~6개월 이전 데이터는 접근 불가
- **최대 조회 건수**: 3,000건/요청

#### 대응 전략
1. **주간 분할 동기화**: 7일 단위로 분할하여 최대 5개월 데이터 수집
2. **스마트 증분 동기화**: 마지막 동기화 이후 변경분만 수집 (2일 버퍼 적용)
3. **UPSERT 전략**: 동일 주문 ID(uniq) 존재 시 최신 데이터로 덮어씀

### 4.3 자동 스케줄링

| 스케줄 | 실행 시간 | 설명 |
|--------|----------|------|
| 일별 증분 동기화 | 매일 새벽 3시 | 마지막 동기화 이후 변경분 수집 (2일 버퍼) |
| 주간 전체 검증 | 매주 일요일 새벽 4시 | 5개월 전체 데이터 재검증 |

> ⚠️ **참고**: 플레이오토 데이터는 영업일에 직원이 수기로 수집하므로, 오늘과 어제 데이터는 완전하지 않을 수 있음

---

## 5. 대시보드 기능

### 5.1 요약 카드 (Summary Cards)
- **총 주문**: 조회 기간 내 총 주문 건수
- **총 매출**: 조회 기간 내 총 판매금액
- **총 판매수량**: 조회 기간 내 총 판매 수량
- **평균 객단가**: 주문 건당 평균 금액

### 5.2 차트 시각화
| 차트 | 설명 |
|------|------|
| 스토어별 매출 | 막대/파이 차트로 스토어별 매출 비교 |
| 상품별 판매 TOP 20 | 판매 상위 20개 상품 순위 |
| 매출 추이 | 일별/월별 매출 및 주문 추이 그래프 |
| 판매 예측 | 이동평균 기반 30일 판매 예측 |

### 5.3 필터 기능
- **기간 프리셋**: 최근 7일, 30일, 이번 달, 지난 달, 최근 3개월, 최근 1년
- **날짜 직접 선택**: 시작일 ~ 종료일 직접 입력
- **스토어 필터**: 특정 스토어만 조회

### 5.4 리포트 다운로드
- **엑셀 다운로드**: 다중 시트 (요약, 스토어별, 상품별, 일별 추이)
- **CSV 다운로드**: 원시 데이터 내보내기

---

## 6. 매출 데이터 분석

### 6.1 매출 필드 정의

| 필드명 | 설명 | 대시보드 사용 |
|--------|------|--------------|
| `sales` | **판매금액** (정가/소비자가 기준) | ✅ 매출 계산에 사용 |
| `pay_amt` | **실결제금액** (소비자 실제 결제액) | ❌ 일부 스토어에서 0으로 수신 |

### 6.2 매출 금액의 의미

**현재 대시보드의 "총 매출"은 `sales` 필드 합계**로, 다음을 의미:
- 상품의 **정가/소비자가 기준** 판매금액
- 할인 전 원가 기준
- 쿠폰, 적립금 차감 전 금액

### 6.3 실제 입금액과의 차이

실제 회사에 입금되는 금액은 다음이 차감됨:

| 차감 항목 | 예상 비율 |
|----------|----------|
| 플랫폼 수수료 | 2~15% (쿠팡 10-15%, 스마트스토어 2-6%) |
| PG 결제 수수료 | 2~3% |
| 쿠폰/할인 (판매자 부담) | 변동 |
| 적립금 사용 | 변동 |
| 배송비 (무료배송 시) | 상품별 상이 |

> 💡 **참고**: 정확한 입금액 조회를 위해서는 PlayAuto 정산 API (`GET /settlements`) 연동 필요

### 6.4 가격 단위 분석

**10원 단위 매출 발생 현황**

| 스토어 | 건수 | 비중 |
|--------|------|------|
| 쿠팡 | 355건 | 99.2% |
| 직접입력 | 3건 | 0.8% |

> 전체 27,874건 중 358건 (1.28%)만 10원 단위

**10원 단위 발생 원인 (쿠팡)**:
- 쿠팡 자체 할인 (로켓배송, 와우회원 할인)
- 퍼센트 쿠폰 적용 시 단수 발생
- 쿠팡캐시/포인트 일부 사용

**10원 단위 금액 예시**:
| 금액 | 상품명 |
|------|--------|
| 36,770원 | 썬화이버 구아검가수분해물 |
| 48,580원 | 다빈치랩 리틀다빈치 설포라판 싱크업 |
| 108,890원 | (국내) 썬화이버 구아검가수분해물 |
| 124,950원 | 풍성밸런스 AMPLE BALANCE 90정 |

---

## 7. 주요 발견 사항

### 7.1 데이터 품질 이슈

#### pay_amt vs sales 필드 불일치
| 스토어 | pay_amt | sales |
|--------|---------|-------|
| 아임웹 | 0 | 정상값 |
| 쿠팡 | 0 | 정상값 |
| 스마트스토어 | 정상값 | 정상값 |

**해결**: 매출 계산 시 `sales` 필드 사용으로 통일

#### 데이터 수집 지연
- 플레이오토 데이터는 직원 수기 수집 방식
- 오늘/어제 데이터는 완전하지 않을 수 있음
- **대응**: 대시보드 기본 조회 기간을 "그저께까지"로 설정

### 7.2 특이 매출 패턴

#### 미리바이오 스마트스토어 프로모션 (2025-12-01~02)
- 2일간 771건 주문, 약 3.63억원 매출 발생
- 일반 일평균 대비 약 10배 이상 급증
- 원인: 프로모션/이벤트로 확인됨

---

## 8. API 엔드포인트 목록

### 8.1 동기화 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| POST | /api/sync | 전체 동기화 (기간 지정) |
| POST | /api/sync/incremental | 최근 7일 증분 동기화 |
| POST | /api/sync/weekly | 주간(7일) 분할 동기화 (최대 5개월) |
| POST | /api/sync/smart | 스마트 증분 동기화 |
| POST | /api/sync/validation | 전체 검증 동기화 |
| GET | /api/sync/status | 동기화 상태 확인 |
| GET | /api/sync/scheduler | 자동 스케줄러 상태 |

### 8.2 통계 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | /api/stats/summary | 전체 요약 (총 주문, 매출 등) |
| GET | /api/stats/by-store | 스토어별 매출/주문 |
| GET | /api/stats/by-product | 상품별 판매 순위 |
| GET | /api/stats/trend | 일별/월별 추이 |
| GET | /api/stats/forecast | 이동평균 기반 예측 |

### 8.3 리포트 API

| Method | Endpoint | 설명 |
|--------|----------|------|
| GET | /api/reports/excel | 엑셀 다운로드 (다중 시트) |
| GET | /api/reports/csv | CSV 다운로드 |

---

## 9. 향후 개선 계획

### 9.1 단기 (1~2주)
- [ ] 정산 API 연동으로 실제 입금액 조회 기능 추가
- [ ] 동기화 실패 시 Slack/Email 알림 구현
- [ ] 모바일 반응형 UI 개선

### 9.2 중기 (1~2개월)
- [ ] PM2를 활용한 프로덕션 배포
- [ ] Nginx 리버스 프록시 설정
- [ ] 사용자 인증 시스템 구축
- [ ] 매출 목표 대비 달성률 대시보드

### 9.3 장기
- [ ] 머신러닝 기반 수요 예측 고도화
- [ ] 재고 연동 및 자동 발주 시스템
- [ ] 마케팅 효과 분석 (프로모션 ROI)

---

## 10. 참고 자료

### 10.1 프로젝트 구조
```
PLAYAUTO_주문내역/
├── server/                 # Express 백엔드
│   ├── app.js              # 서버 진입점
│   ├── routes/             # API 라우터
│   │   ├── shops.js        # 쇼핑몰 목록
│   │   ├── orders.js       # 주문 조회
│   │   ├── sync.js         # 데이터 동기화
│   │   ├── stats.js        # 통계
│   │   └── reports.js      # 리포트
│   ├── services/
│   │   ├── database.js     # SQLite 연결
│   │   ├── playauto.js     # PlayAuto API
│   │   └── scheduler.js    # 자동 스케줄러
│   └── database/
│       └── orders.db       # SQLite DB
│
├── client/                 # React 프론트엔드
│   ├── src/
│   │   ├── App.jsx
│   │   ├── components/
│   │   │   ├── Layout/
│   │   │   ├── Dashboard/
│   │   │   └── Charts/
│   │   └── services/
│   │       └── api.js
│   └── index.html
│
└── .env                    # 환경 변수
```

### 10.2 빠른 실행 명령어
```bash
# 서버 실행
cd server && npm run dev

# 클라이언트 실행
cd client && npm run dev

# 스마트 동기화 실행
curl -X POST http://localhost:3001/api/sync/smart

# 동기화 상태 확인
curl http://localhost:3001/api/sync/status

# 스케줄러 상태 확인
curl http://localhost:3001/api/sync/scheduler
```

### 10.3 관련 문서
- PlayAuto 개발자센터: https://developers.playauto.io
- 프로젝트 문서: `.claude/CLAUDE.md`
- PlayAuto API 분석: `.claude/PLAYAUTO_API.md`

---

## 11. 용어 정리

| 용어 | 설명 |
|------|------|
| uniq | PlayAuto 주문 고유번호 (Primary Key) |
| shop_cd | 쇼핑몰 코드 |
| seller_nick | 스토어 별칭 |
| ord_time | 주문일시 |
| pay_time | 결제완료일시 |
| sales | 판매금액 (정가 기준) |
| pay_amt | 실결제금액 |
| sale_cnt | 주문수량 |
| ord_status | 주문상태 (결제완료, 배송중, 배송완료 등) |

---

> 본 보고서는 2026년 1월 12일 기준으로 작성되었으며, 시스템 업데이트에 따라 내용이 변경될 수 있습니다.
